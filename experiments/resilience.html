<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒçµæŠ¤ç›¾å®éªŒ</title>
    <style>
        :root {
            --ac-mint: #A8D5BA;
            --ac-cream: #FDFaf5;
            --ac-brown: #5B4636;
            --apple-blur: blur(20px);
            --card-high: #e1f5fe;
            --card-med: #fff9c4;
            --card-low: #ffebee;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
            background: transparent; /* èƒŒæ™¯é€æ˜ï¼Œç”±çˆ¶çª—å£æ§åˆ¶ */
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            box-sizing: border-box;
        }

        .container {
            width: 100%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: var(--apple-blur);
            -webkit-backdrop-filter: var(--apple-blur);
            border-radius: 40px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.4);
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* å¯¹è¯æ°”æ³¡æ ·å¼ (åŠ¨æ£®é£) */
        .bubble {
            background: white;
            border: 4px solid var(--ac-mint);
            border-radius: 25px;
            padding: 15px 20px;
            position: relative;
            font-size: 16px;
            color: var(--ac-brown);
            line-height: 1.5;
            box-shadow: 0 4px 0 var(--ac-mint);
        }

        /* æŠ¤ç›¾äº¤äº’åŒº */
        .stage {
            display: flex;
            justify-content: space-around;
            align-items: center;
            gap: 20px;
        }

        .shield-box {
            flex: 1;
            height: 220px;
            background: #F4EDE0; /* æœ¨è´¨åº•è‰² */
            border: 6px solid #8d775f;
            border-radius: 50% 50% 40% 40%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .shield-box.success {
            border-color: var(--ac-mint);
            background: #E8F5E9;
            box-shadow: 0 0 20px var(--ac-mint);
        }

        .shield-icon { font-size: 60px; z-index: 2; }

        .crack {
            position: absolute;
            width: 80%; height: 80%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50 10 L40 40 L60 60 L50 90" stroke="rgba(91,70,54,0.2)" fill="none" stroke-width="4"/></svg>');
            z-index: 1;
        }

        /* å¡ç‰‡å † */
        .cards-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .card {
            background: white;
            padding: 12px;
            border-radius: 15px;
            border: 2px solid #EEE;
            font-size: 14px;
            cursor: grab;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .card.dragging { opacity: 0.5; }
        .card.used { display: none; }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
        }
        .dot { width: 10px; height: 10px; border-radius: 50%; background: #DDD; }
        .dot.active { background: var(--ac-mint); }

    </style>
</head>
<body>

<div class="container">
    <div class="progress-dots">
        <div class="dot active" id="dot-1"></div>
        <div class="dot" id="dot-2"></div>
    </div>

    <div class="bubble" id="scenario-text">
        </div>

    <div class="stage">
        <div class="shield-box" id="shield">
            <div class="crack" id="crack-img"></div>
            <div class="shield-icon" id="shield-icon">ğŸ›¡ï¸</div>
            <p id="counter-text" style="font-size:12px; color:#999; margin-top:10px;">è¿˜éœ€æ‹–å…¥ 3 ä¸ªæƒ³æ³•</p>
        </div>

        <div class="cards-area" id="card-dock">
            </div>
    </div>
</div>

<script>
    // æµ‹è¯„æ•°æ®å®šä¹‰
    const scenarios = [
        {
            text: "<b>åœºæ™¯1ï¼š</b> æ•°å­¦å·å­å‘ä¸‹æ¥äº†ï¼Œä½ åªå¾—äº†65åˆ†ã€‚çœ‹ç€å‘¨å›´åŒå­¦éƒ½åœ¨åº†ç¥ï¼Œä½ æ„Ÿåˆ°å¾ˆæ²®ä¸§...",
            cards: [
                { t: "è¿™æ¬¡é”™é¢˜æ­£å¥½è®©æˆ‘çŸ¥é“å“ªæ²¡å­¦å¥½ã€‚", s: 1 },
                { t: "æˆ‘å¯èƒ½çœŸçš„ä¸æ˜¯å­¦æ•°å­¦çš„æ–™ã€‚", s: 0 },
                { t: "æ”¾å­¦åæˆ‘å»è¯·æ•™ä¸€ä¸‹è€å¸ˆã€‚", s: 1 },
                { t: "è¿™æ¬¡å·å­å¤ªéš¾äº†ï¼Œä¸‹æ¬¡å†åŠªåŠ›ã€‚", s: 0.5 },
                { t: "å¤ªä¸¢è„¸äº†ï¼Œæˆ‘ä¸æƒ³çœ‹å·å­ã€‚", s: 0 }
            ]
        },
        {
            text: "<b>åœºæ™¯2ï¼š</b> ä¸‹åˆåˆ†ç»„åšå®éªŒï¼Œå¤§å®¶éƒ½æ‰¾å¥½äº†ä¼™ä¼´ï¼Œæ²¡äººé‚€è¯·ä½ ã€‚ä½ ç‹¬è‡ªååœ¨åº§ä½ä¸Š...",
            cards: [
                { t: "è‚¯å®šæ˜¯å› ä¸ºå¤§å®¶éƒ½ä¸å–œæ¬¢æˆ‘ã€‚", s: 0 },
                { t: "ä¹Ÿè®¸å¤§å®¶å·²ç»ç»„å¥½é˜Ÿäº†ï¼Œæˆ‘ä¸»åŠ¨é—®é—®ã€‚", s: 1 },
                { t: "æ²¡å…³ç³»ï¼Œä¸€ä¸ªäººåšå®éªŒæ›´æ¸…å‡€ã€‚", s: 0.5 },
                { t: "æˆ‘çœ‹çœ‹è¿˜æœ‰è°å‰©ä¸‹ï¼Œå»é‚€è¯·ä»–ã€‚", s: 1 },
                { t: "ä»¥åæˆ‘å†ä¹Ÿä¸æƒ³å‚åŠ å°ç»„æ´»åŠ¨äº†ã€‚", s: 0 }
            ]
        }
    ];

    let currentIdx = 0;
    let totalScore = 0;
    let selectedInCurrent = 0;
    const maxSelect = 3;

    function initScenario() {
        const scene = scenarios[currentIdx];
        document.getElementById('scenario-text').innerHTML = scene.text;
        document.getElementById('dot-' + (currentIdx + 1)).classList.add('active');
        
        const dock = document.getElementById('card-dock');
        dock.innerHTML = '';
        scene.cards.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.draggable = true;
            div.innerText = item.t;
            div.dataset.score = item.s;
            div.addEventListener('dragstart', () => div.classList.add('dragging'));
            div.addEventListener('dragend', () => div.classList.remove('dragging'));
            dock.appendChild(div);
        });

        // é‡ç½®æŠ¤ç›¾çŠ¶æ€
        selectedInCurrent = 0;
        document.getElementById('counter-text').innerText = `è¿˜éœ€æ‹–å…¥ ${maxSelect} ä¸ªæƒ³æ³•`;
        document.getElementById('shield').classList.remove('success');
        document.getElementById('crack-img').style.display = 'block';
        document.getElementById('shield-icon').innerText = "ğŸ›¡ï¸";
    }

    const shield = document.getElementById('shield');
    shield.addEventListener('dragover', e => e.preventDefault());
    shield.addEventListener('drop', e => {
        const dragging = document.querySelector('.dragging');
        if (dragging && selectedInCurrent < maxSelect) {
            totalScore += parseFloat(dragging.dataset.score);
            selectedInCurrent++;
            dragging.classList.add('used');
            
            document.getElementById('counter-text').innerText = `è¿˜éœ€æ‹–å…¥ ${maxSelect - selectedInCurrent} ä¸ªæƒ³æ³•`;
            
            if (selectedInCurrent === maxSelect) {
                handleStepComplete();
            }
        }
    });

    function handleStepComplete() {
        // è§†è§‰åé¦ˆ
        document.getElementById('shield').classList.add('success');
        document.getElementById('crack-img').style.display = 'none';
        document.getElementById('shield-icon').innerText = "âœ¨";
        document.getElementById('counter-text').innerText = "ä¿®è¡¥æˆåŠŸï¼";

        setTimeout(() => {
            if (currentIdx < scenarios.length - 1) {
                currentIdx++;
                initScenario();
            } else {
                finishExperiment();
            }
        }, 1500);
    }

    function finishExperiment() {
        // è®¡ç®—å¹³å‡åˆ† (ä¸¤åœºæ™¯å…± 6 æ¬¡é€‰æ‹©ï¼Œæ¯åœºæ™¯æœ€é«˜ 3 åˆ†ï¼Œæ€»æœ€é«˜ 6 åˆ†)
        // çˆ¶ç½‘é¡µ radarChart çš„ d7 åˆ»åº¦æ˜¯ 0-3ï¼Œå› æ­¤æˆ‘ä»¬è®¡ç®—å•åœºå¹³å‡éŸ§æ€§å€¼
        const finalScore = (totalScore / scenarios.length).toFixed(1);
        
        // å‘çˆ¶çª—å£å‘é€æ•°æ®
        window.parent.postMessage({
            type: 'experiment_result',
            score: finalScore
        }, '*');
    }

    // å¯åŠ¨ç¬¬ä¸€ä¸ªåœºæ™¯
    initScenario();
</script>

</body>
</html>